üìö Library Management API with RabbitMQ
–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –∫–Ω–∏–≥ –∏ –∞–≤—Ç–æ—Ä–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RabbitMQ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±—Ä–æ–∫–µ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤–º–µ—Å—Ç–æ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω–æ–≥–æ HTTP.

üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
Docker

Docker Compose

Python 3.11+ (—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫  
–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–∏–∑–∏—Ç–æ—Ä–∏–π

```bash
git clone <repository-url>
cd library-api
```
–ó–∞–ø—É—Å—Ç–∏—Ç–µ —á–µ—Ä–µ–∑ Docker Compose

```bash
docker-compose up -d --build
```
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

```bash
docker-compose logs -f api_client
```
üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã
text    
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     RabbitMQ     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    
‚îÇ   –ö–ª–∏–µ–Ω—Ç    ‚îÇ ‚îÄ‚îÄ‚îÄ(—Å–æ–æ–±—â–µ–Ω–∏—è)‚îÄ‚îÄ‚ñ∂‚îÇ    –°–µ—Ä–≤–µ—Ä   ‚îÇ  
‚îÇ (Publisher) ‚îÇ ‚óÄ‚îÄ‚îÄ‚îÄ(–æ—Ç–≤–µ—Ç—ã)‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ (Consumer)  ‚îÇ  
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  
        ‚îÇ                               ‚îÇ  
        ‚îÇ                               ‚ñº  
        ‚îÇ                        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  
        ‚îÇ                        ‚îÇ PostgreSQL  ‚îÇ  
        ‚îÇ                        ‚îÇ   Redis     ‚îÇ  
        ‚îÇ                        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  
        ‚ñº  
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  
‚îÇ  RabbitMQ   ‚îÇ  
‚îÇ   Queue     ‚îÇ  
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  
–°–µ—Ä–≤–∏—Å—ã Docker  
postgres: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

redis: –ö—ç—à –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

rabbitmq: –ë—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π RabbitMQ —Å Web UI

api_server: –°–µ—Ä–≤–µ—Ä API (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–æ–±—â–µ–Ω–∏–π)

api_client: –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API

üì° –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π  
–ó–∞–ø—Ä–æ—Å (Request)  
json 
{  
  "id": "uuid-v4",  
  "version": "v1|v2",  
  "action": "get_authors|create_author|get_books|...",  
  "data": {"page": 1, "size": 10, ...},  
  "auth": "api-key",  
  "idempotency_key": "optional-key",  
  "fields": "id,name,title,...",  
  "correlation_id": "uuid-v4",  
  "reply_to": "queue-name"  
}
–û—Ç–≤–µ—Ç (Response)
json  
{  
  "correlation_id": "uuid-v4",  
  "status": "success|error|validation_error",  
  "data": {} | [],  
  "error": {"code": "...", "message": "..."},  
  "pagination": {"page": 1, "size": 10, "total": 100, "pages": 10} 
}  
üîß API Endpoints  
–í–µ—Ä—Å–∏—è 1 (/api/v1/)  
–ê–≤—Ç–æ—Ä—ã  
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≤—Ç–æ—Ä–æ–≤: get_authors

–ü–æ–ª—É—á–∏—Ç—å –∞–≤—Ç–æ—Ä–∞ –ø–æ ID: get_author

–°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ—Ä–∞: create_author

–û–±–Ω–æ–≤–∏—Ç—å –∞–≤—Ç–æ—Ä–∞: update_author

–£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∞: delete_author

–ö–Ω–∏–≥–∏  
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥: get_books

–ü–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥—É –ø–æ ID: get_book

–°–æ–∑–¥–∞—Ç—å –∫–Ω–∏–≥—É: create_book

–û–±–Ω–æ–≤–∏—Ç—å –∫–Ω–∏–≥—É: update_book

–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É: delete_book

–í–µ—Ä—Å–∏—è 2 (/api/v2/)  
–í—Å–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ v1 –ø–ª—é—Å:

–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–Ω–∏–≥ 
–ü–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥–∏ —Å —Ñ–∏–ª—å—Ç—Ä–æ–º –ø–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: get_books (–ø–∞—Ä–∞–º–µ—Ç—Ä is_available)

–û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–∏–≥–∏: update_book_availability

–ù–æ–≤–æ–µ –ø–æ–ª–µ –≤ –∫–Ω–∏–≥–∞—Ö: is_available (boolean)

üõ†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞  
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º  
```bash
docker-compose exec -it api_client python -m app.client interactive
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Python

```python
from app.rabbitmq_client import RabbitMQClient
from app.schemas_rabbitmq import RequestMessage

client = RabbitMQClient()
request = RequestMessage(
    version="v1",
    action="get_authors",
    auth="test-api-key",
    data={"page": 1, "size": 10}
)
response = client.send_request(request)
```
üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π API –∫–ª—é—á –≤ –ø–æ–ª–µ auth —Å–æ–æ–±—â–µ–Ω–∏—è. –ö–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:


API_KEYS=test-api-key,production-key-123   
‚ôªÔ∏è –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å   
–î–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:

```python
request = RequestMessage(
    action="create_author",
    idempotency_key="unique-key-123",
    # ...
)
```
–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ idempotency_key –≤–µ—Ä–Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

‚ö° Rate Limiting
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ RabbitMQ):

GET –∑–∞–ø—Ä–æ—Å—ã: 100/–º–∏–Ω—É—Ç—É

POST –∑–∞–ø—Ä–æ—Å—ã: 30/–º–∏–Ω—É—Ç—É

PUT/PATCH –∑–∞–ø—Ä–æ—Å—ã: 60/–º–∏–Ω—É—Ç—É

DELETE –∑–∞–ø—Ä–æ—Å—ã: 30/–º–∏–Ω—É—Ç—É

üóÉÔ∏è –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
–ê–≤—Ç–æ—Ä (Author)   
```json   
{   
  "id": 1,   
  "name": "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",  
  "bio": "–†—É—Å—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å...",  
  "birth_date": "1828-09-09",  
  "nationality": "–†—É—Å—Å–∫–∏–π",  
  "created_at": "2024-01-01T12:00:00Z",  
  "updated_at": "2024-01-01T12:00:00Z", 
  "books_count": 10
}
```
–ö–Ω–∏–≥–∞ (Book) - v1
```json
{
  "id": 1,
  "title": "–í–æ–π–Ω–∞ –∏ –º–∏—Ä",
  "isbn": "9785171201234",
  "description": "–†–æ–º–∞–Ω-—ç–ø–æ–ø–µ—è...",
  "year_published": 1869,
  "publisher": "–†—É—Å—Å–∫–∏–π –≤–µ—Å—Ç–Ω–∏–∫",
  "pages": 1225,
  "language": "ru",
  "author_id": 1,
  "created_at": "2024-01-01T12:00:00Z",
  "updated_at": "2024-01-01T12:00:00Z"
}
```
–ö–Ω–∏–≥–∞ (Book) - v2 (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ)
json  
{  
  ...–≤—Å–µ –ø–æ–ª—è –∏–∑ v1...,  
  "is_available": true  
}  

üîÑ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
–î–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è:
  
```python
request = RequestMessage(
    action="get_authors",
    fields="id,name,nationality",  # –¢–æ–ª—å–∫–æ —ç—Ç–∏ –ø–æ–ª—è
    # ...
)
```
–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø–æ–ª—è: author.name, author.nationality.

üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 
Dead Letter Queue (DLQ)  
–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è –≤ api.dlq –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.  

–ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞  
–ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è (–º–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏).  

–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥  
RabbitMQ Management UI: http://localhost:15672 (admin/admin123)

–õ–æ–≥–∏ –æ—à–∏–±–æ–∫: api.errors –æ—á–µ—Ä–µ–¥—å


üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥  
RabbitMQ Management UI  
–î–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:15672  

–õ–æ–≥–∏–Ω: admin

–ü–∞—Ä–æ–ª—å: admin123